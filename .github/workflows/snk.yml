name: Generate Snake Animation

on:
  schedule:
    - cron: "0 0 * * *" # 每天UTC时间0点运行一次
  workflow_dispatch: # 允许手动触发
  push:
    branches:
      - main

jobs:
  generate:
    runs-on: ubuntu-latest
    permissions:
      contents: write # 赋予工作流向仓库写入的权限
    steps:
      - name: 检出主分支
        uses: actions/checkout@v3
        with:
          persist-credentials: false

      - name: 生成贪吃蛇贡献图
        uses: Platane/snk@v3
        with:
          github_user_name: ${{ github.repository_owner }} # 自动使用你的用户名
          outputs: |
            dist/github-snake.svg?color=gradient#gh-dark-mode-only
            dist/github-snake.svg?color=gradient#gh-light-mode-only
          # 图片会输出到仓库根目录的 dist/ 文件夹

      - name: 检查图片是否生成
        run: ls -la dist/ || echo "目录不存在"

      - name: 提交并推送生成的图片到主分支
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          git add dist/
          git commit -m "docs: 更新 GitHub 贡献贪吃蛇图 [skip ci]" || echo "没有变更，无需提交"
          git push
